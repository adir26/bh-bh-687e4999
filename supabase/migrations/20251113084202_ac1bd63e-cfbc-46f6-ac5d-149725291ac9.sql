-- Create inspection_findings table (library of common findings)
CREATE TABLE IF NOT EXISTS public.inspection_findings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  category TEXT NOT NULL,
  finding TEXT NOT NULL,
  description TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- Enable RLS
ALTER TABLE public.inspection_findings ENABLE ROW LEVEL SECURITY;

-- Allow everyone to read findings (it's a reference library)
CREATE POLICY "Anyone can view inspection findings"
  ON public.inspection_findings
  FOR SELECT
  USING (true);

-- Only admins can manage findings
CREATE POLICY "Admins can manage inspection findings"
  ON public.inspection_findings
  FOR ALL
  USING (get_user_role(auth.uid()) = 'admin')
  WITH CHECK (get_user_role(auth.uid()) = 'admin');

-- Insert data from CSV
INSERT INTO public.inspection_findings (category, finding, description) VALUES
('ריצוף וחיפויים', 'אריח שבור', 'נמצא אריח שבור באזור הסלון או המסדרון.'),
('ריצוף וחיפויים', 'אריח רופף', 'האריח משמיע נקישה חלולה ומעיד על חוסר הדבקה תקינה.'),
('ריצוף וחיפויים', 'פערי גובה', 'הבדלי גובה בין אריחים סמוכים מורגשים בעת הליכה.'),
('ריצוף וחיפויים', 'רובה חסרה', 'חסר מילוי בין אריחים – עלול לגרום לחדירת מים ולכלוך.'),
('ריצוף וחיפויים', 'רובה מתפוררת', 'הרובה נפרדת מהריצוף ונראית סדוקה.'),
('ריצוף וחיפויים', 'כתמי דבק על אריחים', 'שאריות דבק או מלט שלא נוקו לאחר ביצוע הריצוף.'),
('ריצוף וחיפויים', 'יישור לקוי', 'האריחים לא יושבים בקו ישר ומפריעים למראה הכללי.'),
('ריצוף וחיפויים', 'הבדלי גוון', 'הבדלי צבע נראים לעין בין אריחים מאותה סדרה.'),
('ריצוף וחיפויים', 'חוסר אחידות ברובה', 'חלק מהמילוי כהה או בהיר מדי ביחס לשאר.'),
('ריצוף וחיפויים', 'שיפוע לא נכון', 'הריצוף אינו משופע לכיוון הניקוז וגורם להצטברות מים.'),
('ריצוף וחיפויים', 'הצפה סביב ניקוז', 'מים מצטברים ליד הניקוז ואינם מתנקזים כראוי.'),
('ריצוף וחיפויים', 'אריח סדוק', 'נראים סדקים דקים או עמוקים באריח.'),
('ריצוף וחיפויים', 'ריצוף מתנדנד', 'האריח אינו יושב יציב וניתן להזיזו בלחיצה.'),
('ריצוף וחיפויים', 'מישקים רחבים מדי', 'פערים גדולים בין האריחים פוגעים באסתטיקה.'),
('ריצוף וחיפויים', 'מישקים צרים מדי', 'המרווחים בין האריחים קטנים מדי ומפריעים לאחידות.'),
('ריצוף וחיפויים', 'חוסר יישור פינות', 'הפינות בין האריחים לא תואמות זו לזו.'),
('ריצוף וחיפויים', 'מעבר לא ישר בין חדרים', 'שינוי ריצוף בין חדרים אינו יושב בקו ישר.'),
('ריצוף וחיפויים', 'גימור קצוות לא אחיד', 'החתכים בקצוות האריחים אינם נקיים או ישרים.'),
('ריצוף וחיפויים', 'חוסר רובה סביב פאנלים', 'אין מילוי תקין בין הפאנל לרצפה.'),
('ריצוף וחיפויים', 'פאנל שבור', 'פאנל סדוק או פגום.'),
('ריצוף וחיפויים', 'הבדלי גובה פאנלים', 'גובה הפאנלים אינו אחיד לאורך הקיר.'),
('ריצוף וחיפויים', 'רובה על הפאנל', 'עודפי רובה נשארו על פני הפאנלים לאחר ניקוי.'),
('ריצוף וחיפויים', 'חוסר ניקיון לאחר ביצוע', 'שאריות לכלוך, אבק ומלט ניכרות על האריחים.'),
('ריצוף וחיפויים', 'שברים בפינות', 'פינות אריחים שבורות או חסרות.'),
('ריצוף וחיפויים', 'חוסר אחידות במרקם', 'שינוי במרקם פני האריחים בין אזורים שונים.'),
('ריצוף וחיפויים', 'שימוש באריחים לא תואמים', 'הותקנו אריחים מדגם או גוון שונה.'),
('ריצוף וחיפויים', 'חוסר רובה סביב עמודים', 'אין מילוי מסביב לעמודים או פינות.'),
('ריצוף וחיפויים', 'מים מתחת לאריחים', 'שומעים קול ''פלופ'' המעיד על מים כלואים.'),
('ריצוף וחיפויים', 'הדבקה חלקית', 'לא כל שטח האריח הודבק לבסיס.'),
('ריצוף וחיפויים', 'אריחים לא אחידים בגודל', 'נראים הבדלים קלים במידות האריחים.'),
('ריצוף וחיפויים', 'מדרגה לא מפולסת', 'הבדלי גובה בין מדרגות שונים מהתקן.'),
('ריצוף וחיפויים', 'ריצוף באמבטיה לא אטום', 'נזילות באזור ריצוף חדרים רטובים.'),
('ריצוף וחיפויים', 'חוסר איטום סביב האסלה', 'חיבור הריצוף סביב האסלה אינו סגור היטב.'),
('ריצוף וחיפויים', 'רובה כהה מדי', 'בחירת גוון הרובה אינה תואמת את צבע האריחים.'),
('ריצוף וחיפויים', 'כתמי מים קבועים', 'כתמים שלא נעלמים גם לאחר ניקוי.'),
('ריצוף וחיפויים', 'הבדלי גובה קיצוניים', 'הבדלים מעל 2 מ"מ בין אריחים סמוכים.'),
('ריצוף וחיפויים', 'חוסר המשכיות עיצובית', 'הדוגמה בריצוף אינה ממשיכה בצורה נכונה.'),
('ריצוף וחיפויים', 'נפילת אריח', 'אריח ניתק מהקיר או מהרצפה.'),
('ריצוף וחיפויים', 'חיתוך לא מדויק סביב דלת', 'החתך סביב המשקוף אינו אחיד.'),
('ריצוף וחיפויים', 'רובה סביב סף דלת חסרה', 'אין איטום באזור המעבר.'),
('ריצוף וחיפויים', 'רובה בולטת מעל פני האריח', 'הרובה לא הוחלקה כראוי.'),
('ריצוף וחיפויים', 'אריחים מוכתמים', 'נשארו כתמים שנבלעו בחומר הגלם.'),
('ריצוף וחיפויים', 'מישקים פתוחים', 'הרובה נפרדה מהאריחים לאורך זמן.'),
('ריצוף וחיפויים', 'שיפוע הפוך במקלחון', 'מים נעים החוצה במקום לניקוז.'),
('ריצוף וחיפויים', 'רובה סביב קירות מתקלפת', 'הרובה בקירות החדר הרטוב מתפרקת.'),
('ריצוף וחיפויים', 'כתם דבק אפוקסי', 'שאריות דבק על פני האריח שלא הוסרו.'),
('ריצוף וחיפויים', 'מדרגה לא סימטרית', 'הבדלים באורך או ברוחב מדרגות.'),
('ריצוף וחיפויים', 'גימור רשלני בפינות', 'החיתוך בפינות אינו מדויק ונראה חובבני.'),
('ריצוף וחיפויים', 'הבדלי מרקם בין אריחים', 'חלק מהאריחים מבריקים וחלק מט.'),
('ריצוף וחיפויים', 'רובה עם בועות', 'בועות אוויר ברובה שנשברו ויצרו חורים קטנים.'),
('ריצוף וחיפויים', 'רובה חסרה מתחת לפאנל', 'חוסר איטום מתחת לפאנל.');

-- Create index for faster searches
CREATE INDEX idx_inspection_findings_category ON public.inspection_findings(category);
CREATE INDEX idx_inspection_findings_finding ON public.inspection_findings(finding);